<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><title>Blazor Game Development - part 1 | Coding with Hans</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://henthoven.github.io/blog/20210630-blazor-game-development-1/cover.png"><meta name=twitter:title content="Blazor Game Development - part 1"><meta name=twitter:description content="During these summer days I thought it would be nice to do a bit of fun programming beside my normal programming job. When thinking about this I realized that during my study time I once developed a side scrolling platform game in C++."><meta property="og:title" content="Blazor Game Development - part 1"><meta property="og:description" content="During these summer days I thought it would be nice to do a bit of fun programming beside my normal programming job. When thinking about this I realized that during my study time I once developed a side scrolling platform game in C++."><meta property="og:type" content="article"><meta property="og:url" content="https://henthoven.github.io/blog/20210630-blazor-game-development-1/"><meta property="og:image" content="https://henthoven.github.io/blog/20210630-blazor-game-development-1/cover.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-06-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-30T00:00:00+00:00"><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link rel=stylesheet href=https://henthoven.github.io/css/medium.5aee7d3a94f3736fcd09e89a822a81da3f807a9fd76f93a89a11a5e448b26e42.css integrity="sha256-Wu59OpTzc2/NCeiagiqB2j+Aep/Xb5OomhGl5EiybkI="><link rel=stylesheet href=https://henthoven.github.io/css/additional.d7ce26e054a52def87f9b29b7b8eacb2a6e55755720063de89a1a440f0aa22e5.css integrity="sha256-184m4FSlLe+H+bKbe46ssqblV1VyAGPeiaGkQPCqIuU="></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://henthoven.github.io/><span style=font-family:Righteous>Coding with Hans</span><span class=site-extention>.NET</span><div class=page-sub-title>Everyting about software development using .NET and C#!</div></a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/blog>Blogs</a></li><li class=nav-item><a class=nav-link href=/about>About</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Coding with Hans</h1><p class=lead>Everyting about software development using .NET and C#!</p></div><div class=main-content><div class=container><div class=row><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><div class="row post-top-meta"><div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right"><img class=author-thumb src=/images/hans-thumb-small.jpg alt="Hans Enthoven"></div><div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left"><a target=_blank class=link-dark>Hans Enthoven</a><br><span class=author-description>Hi, my name is Hans Enthoven. The author of this blog.<br><i class="far fa-star"></i>
Jun 30, 2021
<i class="far fa-clock clock"></i>
5 min read</span></div></div><h1 class=posttitle>Blazor Game Development - part 1</h1></div><img class="featured-image img-fluid" src=https://henthoven.github.io/blog/20210630-blazor-game-development-1/cover.png alt="thumbnail for this post"><div class=article-post><p>During these summer days I thought it would be nice to do a bit of fun programming beside my normal programming job. When thinking about this I realized that during my study time I once developed a side scrolling platform game in C++. When I build that game I did that with some libraries to handle input, graphics, sound, etc. but without a game engine. So things like collision detection, physics and scrolling of the screen where all things I had to implement by myself.</p><p>I came up with the idea to build something similar in .NET using an environment that is relatively new to me. So I decided to make a simple snake game in Blazor. This blog will be the first blog in a series of blog that I will put online this summer. In those blogs I will talk about the challenges you encounter and use simple examples that explain how to handle them. In the last blog I will walk you through the snake game I made and share all the code with you.</p><h2 id=creating-a-game-loop>Creating a game loop</h2><p>When you look at Blazor and webassembly specifically you see that the performance is getting better and better. With this is mind building games in Blazor opens some possibilities. If you want to develop games that run in the webbrowser and you are an experienced .NET developer it is very handy that you can use the programming skills you already have to build that game.</p><p>The fundament of every game is a game loop. This is a loop that runs a lot of times every second (preferable 60 times or more) in which you can update your game logic, handle input and draw the new state of the game to the screen. So my first challenge was how to implement this game loop. After doing some research I found it was fairly easy to do this using the <i>window.requestAnimationFrame</i> (<a href=https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame>https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame</a>) method. This is a method that is implemented by all modern browsers. You can pass in a method of your own and the browser will call that method before the first repaint of the screen. In most browsers this is 60 times per second. But browsers do optimize this to their environment. So when possible (for example because a higher refresh rate of your monitor) it will do a repaint at an even higher frequency. What is important to know is that the browser will call your method only once. So if you want that it calls it continuously you have to call <i>window.requestAnimationFrame</i> again in the method that was called. Let me give you some example code:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>gameLoop</span>(<span style=color:#a6e22e>timeStamp</span>)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;hello&#39;</span>);
</span></span><span style=display:flex><span>			window.<span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>gameLoop</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		window.<span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>gameLoop</span>);
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></p><p>When the browser runs this script you will see a new log in the console stating ‘hello’ about 60 times per second. If we can call our Bazor code from here we have the basis for our game loop.</p><p>To do this we have to register the instance of our Blazor component somewhere in javascript so we can call it from the gameLoop method. To make this possible I make use of the <i>OnAfterRender</i> (<a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components/lifecycle?view=aspnetcore-5.0#after-component-render-onafterrenderasync">https://docs.microsoft.com/en-us/aspnet/core/blazor/components/lifecycle?view=aspnetcore-5.0#after-component-render-onafterrenderasync</a>) method of an ASP.NET core razor component. When this method is called I will call a javascript method using <i>JSInterop</i> to register the instance of my Blazor component in javascript. The following code shows this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span> <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>async</span> Task OnAfterRenderAsync(<span style=color:#66d9ef>bool</span> firstRender)
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (!firstRender)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> JsRuntime.InvokeAsync&lt;<span style=color:#66d9ef>object</span>&gt;(<span style=color:#e6db74>&#34;initGame&#34;</span>, DotNetObjectReference.Create(<span style=color:#66d9ef>this</span>));
</span></span><span style=display:flex><span> }</span></span></code></pre></div><p>Using the <i>JsRuntime.InvokeAsync</i> I call the <i>initGame</i> method in javascript. As a parameter I pass the result of <i>DotNetObjectReference.Create(this)</i>. The result is a reference to my .NET object instance. Looking at the javascript side I added the following <i>initGame</i> method:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span> &lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// the main gameloop. Will be called 60 times per second by requestAnimationFrame
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>gameLoop</span>(<span style=color:#a6e22e>timeStamp</span>) {
</span></span><span style=display:flex><span>        window.<span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>gameLoop</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>invokeMethodAsync</span>(<span style=color:#e6db74>&#39;GameLoop&#39;</span>, <span style=color:#a6e22e>timeStamp</span>, <span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>canvases</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>canvases</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// will be called by blazor to initialize the game and register the game instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    window.<span style=color:#a6e22e>initGame</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>instance</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>canvasContainer</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;canvasContainer&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>canvases</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>canvasContainer</span>.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#39;canvas&#39;</span>) <span style=color:#f92672>||</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        window.<span style=color:#a6e22e>game</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>instance</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>instance</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>canvases</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>canvases</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        window.<span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>gameLoop</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></p><p>Here you see that I create a game object on the <i>window</i> object with a reference to the .NET instance. Next to that you see that I use the game object in my <i>gameLoop</i> method to call a gameLoop method on the instance of my .NET Blazor component. With this in place I have realized the basic game loop and we can start implementing our game logic in the <i>GameLoop</i> method in our Blazor component. This method will now be called 60 times (or more) per second.</p><h2 id=drawing-on-the-screen>Drawing on the screen</h2><p>To draw on the screen I decided to use the NuGet package <i>Blazor.Extensions.Canvas</i>. This is in essence a wrapper around the HTML5 canvas. Using this wrapper you can just call all the HTML5 canvas functions from your C# code. To realize this we need a reference to our canvas inside our C# code. This can easily be done by declaring our canvas and setting a reference to it using the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>BECanvas</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_canvasReference&#34;</span>&gt;&lt;/<span style=color:#f92672>BECanvas</span>&gt;
</span></span><span style=display:flex><span>@code
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    BECanvasComponent _canvasReference = null;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Now we have a reference to our canvas we can start drawing on it from our earlier made <i>GameLoop</i> method. There is a whole list of methods you can call. You can for example draw lines, circles, squares, etc. You can even draw images to the screen. The following code shows how this can be done:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>await</span> _canvasContext.RectAsync(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>);</span></span></code></pre></div><p>The example above will draw a rectangle at x position 10, y position 10 with a width of 100 and a height of 100.</p><p>Because the <i>GameLoop</i> method is called about 60 times per second you can make things move on the screen by making the X and Y position variable. I have worked out some examples showing this. Those examples can be found at:<br><a href=https://github.com/henthoven/BlazorFunExamples>https://github.com/henthoven/BlazorFunExamples</a></p><p>The things described above can be found in the projects <a href=https://github.com/henthoven/BlazorFunExamples/tree/master/Example1 target=_blank>Example1</a> & <a href=https://github.com/henthoven/BlazorFunExamples/tree/master/Example2 target=_blank>Example 2</a>.</p><p>In <a href=/blog/20210711-blazor-game-development-2/>my next blog</a> I will continue on this subject and we will talk about handling input.</p></div><div class=after-post-tags><ul class=tags><li><a href=/tags/blazor>blazor</a></li><li><a href=/tags/dotnet>dotnet</a></li><li><a href=/tags/gaming>gaming</a></li></ul></div><div class=row><div class=col-md-12><div class="share sticky-top sticky-top-offset"><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=Blazor%20Game%20Development%20-%20part%201&url=https%3a%2f%2fhenthoven.github.io%2fblog%2f20210630-blazor-game-development-1%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=435"),!1'><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fhenthoven.github.io%2fblog%2f20210630-blazor-game-development-1%2f" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1'><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fhenthoven.github.io%2fblog%2f20210630-blazor-game-development-1%2f" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1'><i class="fab fa-linkedin"></i></a></li></ul></div></div></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="d-block col-md-6" href=https://henthoven.github.io/blog/20210711-blazor-game-development-2/>&#171; Blazor Game Development - part 2</a>
<a class="d-block col-md-6 text-lg-right" href=https://henthoven.github.io/blog/20200525-csharep9myopinion/>My thoughts on C# 9.0 &#187;</a><div class=clearfix></div></div></div></div></div></div></div><div class="jumbotron fortags"><div class="d-md-flex h-100"><div class="col-md-9 p-5 align-self-center text-center"><a class="mt-1 mb-1" href=/tags/blazor>blazor</a>
<a class="mt-1 mb-1" href=/tags/csharp>csharp</a>
<a class="mt-1 mb-1" href=/tags/dotnet>dotnet</a>
<a class="mt-1 mb-1" href=/tags/dotnetcore>dotnetcore</a>
<a class="mt-1 mb-1" href=/tags/gaming>gaming</a></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-12 col-sm-12 text-center text-lg-left">&copy; Copyright Hans Enthoven - All rights reserved</div><div class="col-md-6 col-sm-6 text-center text-lg-right"></div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=https://henthoven.github.io/js/mediumish.e4b90c58dfa15ac82caf2edfa01e5fd047e17bc15e6babe5c0e442a4407d0b25.js integrity="sha256-5LkMWN+hWsgsry7foB5f0Efhe8Fea6vlwORCpEB9CyU="></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-1XXXXXXX1-X","auto"),ga("send","pageview"))</script></body></html>